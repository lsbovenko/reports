{"version":3,"sources":["../../../src/mvc/reports/create.js"],"names":["$","rv","$date","$form","emptyRecord","name","description","workedTime","hours","minutes","datepicker","onSelect","dateStr","date","inst","hide","data","formData","test","reports","tracked","untracked","durationPickerOptions","onUpdate","duration","parent","find","text","select2Options","tags","width","placeholder","allowClear","controller","addMoreTracked","push","addMoreUntracked","updateTime","e","scope","report","sendNewReport","parsley","isValid","validate","sendData","forEach","r","time","isTracked","ajax","url","method","success","amaran","bind","selectDate","Date","jQuery","rivets"],"mappings":"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","file":"create.js","sourcesContent":[";(function ($, rv) {\r\n\r\n    const $date = $('#date'),\r\n        $form = $('#report-form'),\r\n        emptyRecord = () => { return {name: '', description: '', workedTime: {hours: 0, minutes: 0}} },\r\n        datepicker = $date.datepicker({\r\n            onSelect(dateStr, date, inst) {\r\n                inst.hide();\r\n            }\r\n        }).data('datepicker');\r\n\r\n    let formData = {\r\n        test: true,\r\n        reports: {\r\n            tracked: [],\r\n            untracked: []\r\n        },\r\n        durationPickerOptions: {\r\n          onUpdate(duration) {\r\n              $(this)\r\n                  .parent()\r\n                  .parent()\r\n                  .find('label').text('Время (' + duration.hours + 'ч:' + duration.minutes + 'м)');\r\n\r\n          }\r\n        },\r\n        select2Options: {\r\n            tags: true,\r\n            width: '100%',\r\n            placeholder: \"Выбрать/Добавить\",\r\n            allowClear: true\r\n        },\r\n        controller: {\r\n            addMoreTracked() {\r\n                formData.reports.tracked.push(emptyRecord());\r\n            },\r\n            addMoreUntracked() {\r\n                formData.reports.untracked.push(emptyRecord());\r\n            },\r\n            updateTime(e, scope) {\r\n                scope.report.workedTime = $(this).duration('getFormatted', true);\r\n            },\r\n            sendNewReport() {\r\n\r\n                if (!$form.parsley().isValid()) {\r\n                    $form.parsley().validate();\r\n\r\n                    return ;\r\n                }\r\n\r\n                let sendData = { reports: [] };\r\n\r\n                formData.reports.tracked.forEach(function(r){\r\n                    sendData.reports.push({\r\n                        name: r.name,\r\n                        time: r.workedTime,\r\n                        description: r.description,\r\n                        isTracked: 1\r\n                    });\r\n                });\r\n\r\n                formData.reports.untracked.forEach(function(r){\r\n                    sendData.reports.push({\r\n                        name: r.name,\r\n                        time: r.workedTime,\r\n                        description: r.description,\r\n                        isTracked: 0\r\n                    });\r\n                });\r\n\r\n                $.ajax({\r\n                    url: '/reports/store',\r\n                    method: 'POST',\r\n                    data: sendData,\r\n                    success() {\r\n                        formData.reports.tracked = [];\r\n                        formData.reports.untracked = [];\r\n\r\n                        $.amaran({\r\n                            'message'   :'Данные были отпралвены.',\r\n                            'position'  :'bottom right'\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    rv.bind($form, formData);\r\n    datepicker.selectDate(new Date()); //select current date by default\r\n\r\n})(jQuery, rivets);"]}