{"version":3,"sources":["../../../src/mvc/reports/create.js"],"names":["$","rv","formatters","not","value","$date","$form","emptyRecord","isTracked","name","description","workedTime","hours","minutes","datepicker","maxDate","Date","onSelect","dateStr","date","inst","hide","data","formData","test","reports","tracked","untracked","durationPickerOptions","onUpdate","duration","parent","find","text","select2Options","tags","width","placeholder","allowClear","controller","addMoreTracked","push","addMoreUntracked","updateTime","e","scope","report","removeReport","deleted","sendNewReport","parsley","isValid","validate","sendData","val","forEach","r","time","ajax","url","method","success","amaran","bind","selectDate","jQuery","rivets"],"mappings":"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","file":"create.js","sourcesContent":[";(function ($, rv) {\r\n\r\n    rv.formatters.not = function (value) {\r\n        return !value;\r\n    };\r\n\r\n    const $date = $('#date'),\r\n        $form = $('#report-form'),\r\n        emptyRecord = (isTracked = false) => {\r\n            return {name: '', description: '', workedTime: {hours: 0, minutes: 0}, isTracked}\r\n        },\r\n        datepicker = $date.datepicker({\r\n            maxDate: new Date(),\r\n            onSelect(dateStr, date, inst) {\r\n                inst.hide();\r\n            }\r\n        }).data('datepicker');\r\n\r\n    let formData = {\r\n        test: true,\r\n        reports: {\r\n            tracked: [],\r\n            untracked: []\r\n        },\r\n        durationPickerOptions: {\r\n            onUpdate(duration) {\r\n                $(this)\r\n                    .parent()\r\n                    .parent()\r\n                    .find('label').text('Время (' + duration.hours + 'ч:' + duration.minutes + 'м)');\r\n\r\n            }\r\n        },\r\n        select2Options: {\r\n            tags: true,\r\n            width: '100%',\r\n            placeholder: \"Выбрать/Добавить\",\r\n            allowClear: true\r\n        },\r\n        controller: {\r\n            addMoreTracked() {\r\n                formData.reports.tracked.push(emptyRecord(true));\r\n            },\r\n            addMoreUntracked() {\r\n                formData.reports.untracked.push(emptyRecord());\r\n            },\r\n            updateTime(e, scope) {\r\n                scope.report.workedTime = $(this).duration('getFormatted', true);\r\n            },\r\n            removeReport(e, scope){\r\n                scope.report.deleted = true;\r\n            },\r\n            sendNewReport() {\r\n\r\n                if (!$form.parsley().isValid()) {\r\n                    $form.parsley().validate();\r\n\r\n                    return;\r\n                }\r\n\r\n                let sendData = {reports: [], date: $date.val()};\r\n\r\n                formData.reports.tracked.forEach(function (r) {\r\n                    if (r.deleted) return ;\r\n\r\n                    sendData.reports.push({\r\n                        name: r.name,\r\n                        time: r.workedTime,\r\n                        description: r.description,\r\n                        isTracked: 1\r\n                    });\r\n                });\r\n\r\n                formData.reports.untracked.forEach(function (r) {\r\n                    if (r.deleted) return ;\r\n\r\n                    sendData.reports.push({\r\n                        name: r.name,\r\n                        time: r.workedTime,\r\n                        description: r.description,\r\n                        isTracked: 0\r\n                    });\r\n                });\r\n\r\n                $.ajax({\r\n                    url: '/reports/store',\r\n                    method: 'POST',\r\n                    data: sendData,\r\n                    success() {\r\n                        formData.reports.tracked = [];\r\n                        formData.reports.untracked = [];\r\n\r\n                        $.amaran({\r\n                            'message': 'Данные были отпралвены.',\r\n                            'position': 'bottom right'\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    rv.bind($form, formData);\r\n    datepicker.selectDate(new Date()); //select current date by default\r\n\r\n})(jQuery, rivets);"]}