{"version":3,"sources":["../../../src/mvc/reports/create.js"],"names":["$","rv","$date","$form","emptyRecord","isTracked","name","description","workedTime","hours","minutes","datepicker","onSelect","dateStr","date","inst","hide","data","formData","test","reports","tracked","untracked","durationPickerOptions","onUpdate","duration","parent","find","text","select2Options","tags","width","placeholder","allowClear","controller","addMoreTracked","push","addMoreUntracked","updateTime","e","scope","report","removeReport","ref","updated","closest","remove","splice","index","sendNewReport","parsley","isValid","validate","sendData","forEach","r","time","ajax","url","method","success","amaran","window","bind","selectDate","Date","jQuery","rivets"],"mappings":"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","file":"create.js","sourcesContent":[";(function ($, rv) {\r\n\r\n    const $date = $('#date'),\r\n        $form = $('#report-form'),\r\n        emptyRecord = (isTracked = false) => {\r\n            return {name: '', description: '', workedTime: {hours: 0, minutes: 0}, isTracked}\r\n        },\r\n        datepicker = $date.datepicker({\r\n            onSelect(dateStr, date, inst) {\r\n                inst.hide();\r\n            } \r\n        }).data('datepicker');\r\n\r\n    let formData = {\r\n        test: true,\r\n        reports: {\r\n            tracked: [],\r\n            untracked: []\r\n        },\r\n        durationPickerOptions: {\r\n            onUpdate(duration) {\r\n                $(this)\r\n                    .parent()\r\n                    .parent()\r\n                    .find('label').text('Время (' + duration.hours + 'ч:' + duration.minutes + 'м)');\r\n\r\n            }\r\n        },\r\n        select2Options: {\r\n            tags: true,\r\n            width: '100%',\r\n            placeholder: \"Выбрать/Добавить\",\r\n            allowClear: true\r\n        },\r\n        controller: {\r\n            addMoreTracked() {\r\n                formData.reports.tracked.push(emptyRecord(true));\r\n            },\r\n            addMoreUntracked() {\r\n                formData.reports.untracked.push(emptyRecord());\r\n            },\r\n            updateTime(e, scope) {\r\n                scope.report.workedTime = $(this).duration('getFormatted', true);\r\n            },\r\n            removeReport(e, scope){\r\n                let report = scope.report,\r\n                    ref = report.isTracked ? scope.reports.tracked : scope.reports.untracked,\r\n                    updated = [];\r\n\r\n                $(this).closest('.report-container').remove();\r\n\r\n                ref.splice(scope.index, 1); //suddenly it is buggy :(\r\n            },\r\n            sendNewReport() {\r\n\r\n                if (!$form.parsley().isValid()) {\r\n                    $form.parsley().validate();\r\n\r\n                    return;\r\n                }\r\n\r\n                let sendData = {reports: []};\r\n\r\n                formData.reports.tracked.forEach(function (r) {\r\n                    sendData.reports.push({\r\n                        name: r.name,\r\n                        time: r.workedTime,\r\n                        description: r.description,\r\n                        isTracked: 1\r\n                    });\r\n                });\r\n\r\n                formData.reports.untracked.forEach(function (r) {\r\n                    sendData.reports.push({\r\n                        name: r.name,\r\n                        time: r.workedTime,\r\n                        description: r.description,\r\n                        isTracked: 0\r\n                    });\r\n                });\r\n\r\n                $.ajax({\r\n                    url: '/reports/store',\r\n                    method: 'POST',\r\n                    data: sendData,\r\n                    success() {\r\n                        formData.reports.tracked = [];\r\n                        formData.reports.untracked = [];\r\n\r\n                        $.amaran({\r\n                            'message': 'Данные были отпралвены.',\r\n                            'position': 'bottom right'\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    window.tracked = formData.reports.tracked;\r\n    rv.bind($form, formData);\r\n    datepicker.selectDate(new Date()); //select current date by default\r\n\r\n})(jQuery, rivets);"]}