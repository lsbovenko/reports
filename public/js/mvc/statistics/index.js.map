{"version":3,"sources":["../../../src/mvc/statistics/index.js"],"names":["$","Vue","G","$date","$datepickerRange","datepicker","maxDate","Date","minDate","inline","onSelect","dateStr","datesArray","inst","opts","range","selectedDates","length","app","filterParams","dates","data","nounEnding","number","endingArray","ending","i","formatMinutes","minutes","hours","parseInt","users","forEach","u","isActive","el","statistics","user_id","methods","fullName","user","last_name","name","inArray","needle","haystack","filterByUser","event","previousActiveUser","id","computed","map","d","toString","totalInRange","result","tracked","untracked","stats","stat","tracked_logged_minutes","untracked_logged_minutes","total","watch","deep","handler","_filterParamsWathcerInit","that","sendData","getFullYear","getMonth","getDate","ajax","url","success","chartData","chart","update","filters","Chart","type","options","scales","yAxes","ticks","beginAtZero","min","max","stepSize","stacked","xAxes","barPercentage","tooltips","callbacks","label","descriptor","yLabel","toFixed","onClick","evt","getElementAtEvent","_model","clickedDate","selectDate","prop","selectedDate","on","is","jQuery","window","_globals"],"mappings":"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","file":"index.js","sourcesContent":[";(function ($, Vue, G) {\r\n\r\n    const $date = $('#date'),\r\n        $datepickerRange = $('#datepicker-range'),\r\n        datepicker = $date.datepicker({\r\n            maxDate: new Date(),\r\n            minDate: new Date(G.minDate),\r\n            inline: true,\r\n            onSelect(dateStr, datesArray, inst) {\r\n\r\n                if (inst.opts.range && inst.selectedDates.length === 2) {\r\n                    app.filterParams.dates = inst.selectedDates;\r\n                } else if (!inst.opts.range) {\r\n                    app.filterParams.dates = inst.selectedDates;\r\n                }\r\n            }\r\n\r\n        }).data('datepicker'),\r\n        nounEnding = function (number, endingArray) {\r\n            let ending = '';\r\n\r\n            number = number % 100;\r\n            if (number >= 11 && number <= 19) {\r\n                ending = endingArray[2];\r\n            }\r\n            else {\r\n                let i = number % 10;\r\n                switch (i) {\r\n                    case (1):\r\n                        ending = endingArray[0];\r\n                        break;\r\n                    case (2):\r\n                    case (3):\r\n                    case (4):\r\n                        ending = endingArray[1];\r\n                        break;\r\n                    default:\r\n                        ending = endingArray[2];\r\n                }\r\n            }\r\n            return ending;\r\n\r\n        },\r\n        formatMinutes = function (minutes) {\r\n            let hours = parseInt(minutes / 60);\r\n\r\n            minutes = minutes % 60;\r\n\r\n            return hours +\r\n                ' ' +\r\n                nounEnding(hours, ['час', 'часа', 'часов']) +\r\n                ' ' +\r\n                minutes +\r\n                ' ' +\r\n                nounEnding(minutes, ['минута', 'минуты', 'минут']);\r\n        };\r\n\r\n    //add additional properties\r\n    if (G.users) {\r\n        G.users.forEach(u => u.isActive = false);\r\n    }\r\n\r\n    let app = new Vue({\r\n            el: '#app',\r\n            data: {\r\n                users: G.users || [],\r\n                statistics: G.statistics || [],\r\n                filterParams: {\r\n                    user_id: null,\r\n                    dates: ['']\r\n                }\r\n            },\r\n            methods: {\r\n                fullName(user) {\r\n                    return user.last_name + ' ' + user.name;\r\n                },\r\n                inArray(needle, haystack) {\r\n                    return $.inArray(needle, haystack) !== -1;\r\n                },\r\n                filterByUser(user, event) {\r\n                    if (this.previousActiveUser) {\r\n                        this.previousActiveUser.isActive = false;\r\n                    }\r\n\r\n                    user.isActive = true;\r\n                    this.previousActiveUser = user;\r\n                    this.filterParams.user_id = user.id;\r\n                }\r\n            },\r\n            computed: {\r\n                selectedDates(){\r\n                    return this.filterParams.dates.map(d => d.toString());\r\n                },\r\n                totalInRange(){\r\n                    let result = {tracked: 0, untracked: 0};\r\n\r\n                    this.statistics.forEach(stats => {\r\n                        stats.forEach(stat => {\r\n                            result.tracked += stat.tracked_logged_minutes;\r\n                            result.untracked += stat.untracked_logged_minutes;\r\n                        });\r\n\r\n                    });\r\n\r\n                    return {\r\n                        tracked: formatMinutes(result.tracked),\r\n                        untracked: formatMinutes(result.untracked),\r\n                        total: formatMinutes(result.tracked + result.untracked)\r\n                    };\r\n                }\r\n            },\r\n            watch: {\r\n                filterParams: {\r\n                    deep: true,\r\n                    handler() {\r\n                        //prevent from very first run\r\n                        if (!this._filterParamsWathcerInit) {\r\n                            this._filterParamsWathcerInit = true;\r\n                            return;\r\n                        }\r\n\r\n                        let that = this,\r\n                            sendData = {\r\n                                user_id: this.filterParams.user_id,\r\n                                dates: this.filterParams.dates.map(d => d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate())\r\n                            };\r\n\r\n                        $.ajax({\r\n                            url: '/statistics/filter',\r\n                            data: sendData,\r\n                            success(statistics) {\r\n                                that.statistics = statistics;\r\n\r\n                            }\r\n                        });\r\n\r\n                        // if user is selected then we have to visualize data with chart\r\n                        // thus we need to obtain corresponding data\r\n                        if (this.filterParams.user_id) {\r\n                            $.ajax({\r\n                                url: '/statistics/chart-data',\r\n                                data: sendData,\r\n                                success(chartData) {\r\n                                    chart.data = chartData;\r\n                                    chart.update();\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            filters: {\r\n                formatMinutes\r\n            }\r\n        }),\r\n        chart = new Chart($('#chart'), {\r\n            type: 'bar',\r\n            data: {},\r\n            options: {\r\n                scales: {\r\n                    yAxes: [{\r\n                        ticks: {\r\n                            beginAtZero: true,\r\n                            min: 0,\r\n                            max: 15,\r\n                            stepSize: 1\r\n                        },\r\n                        stacked: true\r\n                    }],\r\n                    xAxes: [{\r\n                        stacked: true,\r\n                        barPercentage: 0.7\r\n                    }]\r\n                },\r\n                tooltips: {\r\n                    callbacks: {\r\n                        label(descriptor){\r\n                            return formatMinutes((descriptor.yLabel * 60).toFixed(2));\r\n                        }\r\n                    }\r\n                },\r\n                onClick(evt) {\r\n                    if (!chart.getElementAtEvent(evt).length) return;\r\n\r\n                    let label = chart.getElementAtEvent(evt)[0]._model.label,\r\n                        clickedDate = new Date(label + '/' + (new Date()).getFullYear());\r\n\r\n                    // disable range mode and select clicked date\r\n                    datepicker.update('range', false);\r\n                    datepicker.selectDate(clickedDate);\r\n                    $datepickerRange.prop('checked', false);\r\n                }\r\n            }\r\n        });\r\n\r\n    datepicker.selectDate(new Date(G.selectedDate)); //select current date by default\r\n\r\n    $datepickerRange.on('change', function () {\r\n        datepicker.update('range', $(this).is(':checked'));\r\n    });\r\n\r\n})(jQuery, Vue, window._globals || {});"]}